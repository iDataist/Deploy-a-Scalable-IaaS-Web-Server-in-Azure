huiren packer $ packer build server.json
azure-arm: output will be in this color.

==> azure-arm: Running builder ...
==> azure-arm: Getting tokens using client secret
==> azure-arm: Getting tokens using client secret
    azure-arm: Creating Azure Resource Manager (ARM) client ...
==> azure-arm: WARNING: Zone resiliency may not be supported in West US 2, checkout the docs at https://docs.microsoft.com/en-us/azure/availability-zones/
==> azure-arm: Creating resource group ...
==> azure-arm:  -> ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> Location          : 'West US 2'
==> azure-arm:  -> Tags              :
==> azure-arm:  ->> DevOps : Deploy a Web Server in Azure
==> azure-arm: Validating deployment template ...
==> azure-arm:  -> ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> DeploymentName    : 'pkrdp32wmd21k9x'
==> azure-arm: Deploying deployment template ...
==> azure-arm:  -> ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> DeploymentName    : 'pkrdp32wmd21k9x'
==> azure-arm:
==> azure-arm: Getting the VM's IP address ...
==> azure-arm:  -> ResourceGroupName   : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> PublicIPAddressName : 'pkrip32wmd21k9x'
==> azure-arm:  -> NicName             : 'pkrni32wmd21k9x'
==> azure-arm:  -> Network Connection  : 'PublicEndpoint'
==> azure-arm:  -> IP Address          : '13.66.243.53'
==> azure-arm: Waiting for SSH to become available...
==> azure-arm: Connected to SSH!
==> azure-arm: Provisioning with shell script: /var/folders/1l/80bgl5gj0z30lxdxs2zrv44r0000gn/T/packer-shell818926148
==> azure-arm: + echo Hello, World!
==> azure-arm: Querying the machine's properties ...
==> azure-arm:  -> ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> ComputeName       : 'pkrvm32wmd21k9x'
==> azure-arm:  -> Managed OS Disk   : '/subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Compute/disks/pkros32wmd21k9x'
==> azure-arm: Querying the machine's additional disks properties ...
==> azure-arm:  -> ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> ComputeName       : 'pkrvm32wmd21k9x'
==> azure-arm: Powering off machine ...
==> azure-arm:  -> ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> ComputeName       : 'pkrvm32wmd21k9x'
==> azure-arm: Capturing image ...
==> azure-arm:  -> Compute ResourceGroupName : 'pkr-Resource-Group-32wmd21k9x'
==> azure-arm:  -> Compute Name              : 'pkrvm32wmd21k9x'
==> azure-arm:  -> Compute Location          : 'West US 2'
==> azure-arm:  -> Image ResourceGroupName   : 'rg'
==> azure-arm:  -> Image Name                : 'Ubuntu18.04'
==> azure-arm:  -> Image Location            : 'West US 2'
==> azure-arm: 
==> azure-arm: Deleting individual resources ...
==> azure-arm: Adding to deletion queue -> Microsoft.Compute/virtualMachines : 'pkrvm32wmd21k9x'
==> azure-arm: Adding to deletion queue -> Microsoft.Network/networkInterfaces : 'pkrni32wmd21k9x'
==> azure-arm: Adding to deletion queue -> Microsoft.Network/publicIPAddresses : 'pkrip32wmd21k9x'
==> azure-arm: Adding to deletion queue -> Microsoft.Network/virtualNetworks : 'pkrvn32wmd21k9x'
==> azure-arm: Waiting for deletion of all resources...
==> azure-arm: Attempting deletion -> Microsoft.Network/networkInterfaces : 'pkrni32wmd21k9x'
==> azure-arm: Attempting deletion -> Microsoft.Compute/virtualMachines : 'pkrvm32wmd21k9x'
==> azure-arm: Attempting deletion -> Microsoft.Network/virtualNetworks : 'pkrvn32wmd21k9x'
==> azure-arm: Attempting deletion -> Microsoft.Network/publicIPAddresses : 'pkrip32wmd21k9x'
==> azure-arm: Error deleting resource. Will retry.
==> azure-arm: Name: pkrvn32wmd21k9x
==> azure-arm: Error: network.VirtualNetworksClient#Delete: Failure sending request: StatusCode=400 -- Original Error: Code="InUseSubnetCannotBeDeleted" Message="Subnet pkrsn32wmd21k9x is in use by /subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Network/networkInterfaces/pkrni32wmd21k9x/ipConfigurations/ipconfig and cannot be deleted. In order to delete the subnet, delete all the resources within the subnet. See aka.ms/deletesubnet." Details=[]
==> azure-arm:
==> azure-arm: Error deleting resource. Will retry.
==> azure-arm: Name: pkrip32wmd21k9x
==> azure-arm: Error: network.PublicIPAddressesClient#Delete: Failure sending request: StatusCode=400 -- Original Error: Code="PublicIPAddressCannotBeDeleted" Message="Public IP address /subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Network/publicIPAddresses/pkrip32wmd21k9x can not be deleted since it is still allocated to resource /subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Network/networkInterfaces/pkrni32wmd21k9x/ipConfigurations/ipconfig. In order to delete the public IP, disassociate/detach the Public IP address from the resource.  To learn how to do this, see aka.ms/deletepublicip." Details=[]
==> azure-arm:
==> azure-arm: Attempting deletion -> Microsoft.Network/virtualNetworks : 'pkrvn32wmd21k9x'
==> azure-arm: Attempting deletion -> Microsoft.Network/publicIPAddresses : 'pkrip32wmd21k9x'
==> azure-arm:  Deleting -> Microsoft.Compute/disks : '/subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Compute/disks/pkros32wmd21k9x'
==> azure-arm: Removing the created Deployment object: 'pkrdp32wmd21k9x'
==> azure-arm: 
==> azure-arm: Cleanup requested, deleting resource group ...
==> azure-arm: Resource group has been deleted.
Build 'azure-arm' finished after 6 minutes 27 seconds.

==> Wait completed after 6 minutes 27 seconds

==> Builds finished. The artifacts of successful builds are:
--> azure-arm: Azure.ResourceManagement.VMImage:

OSType: Linux
ManagedImageResourceGroupName: rg
ManagedImageName: Ubuntu18.04
ManagedImageId: /subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/rg/providers/Microsoft.Compute/images/Ubuntu18.04
ManagedImageLocation: West US 2

huiren packer $ az image list
[
  {
    "extendedLocation": null,
    "hyperVGeneration": "V1",
    "id": "/subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/RG/providers/Microsoft.Compute/images/Ubuntu18.04",
    "location": "westus2",
    "name": "Ubuntu18.04",
    "provisioningState": "Succeeded",
    "resourceGroup": "RG",
    "sourceVirtualMachine": {
      "id": "/subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Compute/virtualMachines/pkrvm32wmd21k9x",
      "resourceGroup": "pkr-Resource-Group-32wmd21k9x"
    },
    "storageProfile": {
      "dataDisks": [],
      "osDisk": {
        "blobUri": null,
        "caching": "ReadWrite",
        "diskEncryptionSet": null,
        "diskSizeGb": 30,
        "managedDisk": {
          "id": "/subscriptions/5bb35c36-233e-4b7e-afd9-a2b795899fb9/resourceGroups/pkr-Resource-Group-32wmd21k9x/providers/Microsoft.Compute/disks/pkros32wmd21k9x",
          "resourceGroup": "pkr-Resource-Group-32wmd21k9x"
        },
        "osState": "Generalized",
        "osType": "Linux",
        "snapshot": null,
        "storageAccountType": "Standard_LRS"
      },
      "zoneResilient": false
    },
    "tags": {
      "DevOps": "Deploy a Web Server in Azure"
    },
    "type": "Microsoft.Compute/images"
  }
]